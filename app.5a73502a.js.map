{"version":3,"sources":["../translation/chi.json","js/app.js"],"names":["module","exports","default_title","logo_brand","request","error","bad_url","timeout","network_error","bad_status","bad_body","status_code","other_status_codes","uploader","uploading_video","uploading_subtitle","uploaded","failed_to_upload_video","failed_to_upload_subtitle","native_client","attempting_to_launch","attempting_to_connect","prompt_part1","prompt_part2","prompt_part3","prompt_part4","prompt_part5","connected","incompatible","version_unknown","disconnected","platform_error","unknown","page","portal","page_title","add_files","add_files_empty_state","support_video_format","support_subtitle_format","choose_presets","start_processing","remove_picked_video","batch_remove_picked_videos","abort_removal_of_picked_videos","with_subtitle_badge","without_subtitle_badge","prompt_already_uploaded_subtitle","replace_subtitle","remove_subtitle","keep_current_subtitle","search_box_placeholder","btn_review_subtitle","btn_add_subtitle","btn_delete_project","btn_edit_project","deletion_confirmation","have_upload","project","nav","save_project","back_to_portal","preview_project","export_project","prompt","successfully_saved","failed_to_save","failed_to_export","exporting","left_panel","save_project_and_leave","discard_changes_and_leave","prompt_unsaved_changes","stay_on_page","exporting_in_progress","frontend_version","native_client_version","project_size","stop_previewing","right_panel","hidden_content","restore_hidden_content","new_textual_content","project_size_label","btn_drag_handle","btn_convert_to_gif","btn_revert_back_to_frames","btn_add_text","btn_delete","btn_merge","view_type","leading_text","hidden","small","normal","large","processing","preset","custom","file_not_found","bad_parameters","cannot_decode_video","processing_status","not_started","started","completed","failed","project_not_found","project_export","source_file_not_found","media_files_missing","project_saving","readStringifiedJson","str","JSON","parse","app","Elm","Main","init","flags","token","localStorage","translations","hostname","location","document","addEventListener","event","preventDefault","key","ctrlKey","ports","seekTime","subscribe","milliseconds","video","querySelector","currentTime","play","connectSocket","socket","WebSocket","websocketClosed","send","code","message","data","handleSocketEvent","handleProcessProgressEvent","handleProcessFailureEvent","uuid","Parameter","Id","Status","processingStatusUpdate","progress","Progress","status","reason","ErrorMsg","undoTrix","activeElement","editor","undo","redoTrix","redo","scrollIntoView","nodeID","getElementById","promptUserBeforeUnload","returnValue","history","pushState","window","url","addBeforeUnloadPrompt","pathname","removeBeforeUnloadPrompt","removeEventListener","RichTextPreview","HTMLElement","setContent","content","getAttribute","innerHTML","customElements","define","previousHref","href","onload","body","MutationObserver","mutations","forEach","mutation","_czc","push","observe","childList","subtree"],"mappings":"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","file":"app.5a73502a.js","sourceRoot":"../web","sourcesContent":["module.exports={default_title:\"剪刀兔\",logo_brand:\"剪刀兔\",request:{error:{bad_url:\"请求的URL格式不正确\",timeout:\"请求超时\",network_error:\"无法连接网络\",bad_status:\"无法完成请求\",bad_body:\"返回数据的格式不正确\"},status_code:{400:\"请求格式不正确\",401:\"未认证\",403:\"禁止访问\",404:\"无法找到请求的资源\",413:\"请求实体太大\",422:\"请求语义不正确\",500:\"服务器端错误\",502:\"网关错误\",503:\"服务暂时不可用\",504:\"上游服务请求超时\",other_status_codes:\"无法完成请求 - 错误码：{{status_code}}\"}},uploader:{uploading_video:\"视频上传中\",uploading_subtitle:\"字幕上传中\",uploaded:\"上传完成\",failed_to_upload_video:\"视频上传失败，请刷新本页面后重试\",failed_to_upload_subtitle:\"字幕上传失败，请刷新本页面后重试\"},native_client:{attempting_to_launch:\"尝试启动中……\",attempting_to_connect:\"尝试连接中……\",prompt_part1:\"请\",prompt_part2:\"点击此处\",prompt_part3:\"启动剪刀兔客户端，如尚未安装，请\",prompt_part4:\"下载并运行客户端\",prompt_part5:\"。\",connected:\"已连接\",incompatible:\"本地客户端版本不兼容\",version_unknown:\"未知的本地客户端版本\",disconnected:\"无法连接本地客户端\",platform_error:\"请求的URL地址不正确\",unknown:\"未知状态\"},page:{portal:{page_title:\"视频列表-剪刀兔\",add_files:\"添加\",add_files_empty_state:\"点击添加视频或字幕文件\",support_video_format:\"支持视频格式：mp4, flv, avi, wmv, mov, webm, mpeg, m4v, mpg\",support_subtitle_format:\"支持字幕格式：srt, vtt\",choose_presets:\"选择视频处理预设\",start_processing:\"开始\",remove_picked_video:\"删除\",batch_remove_picked_videos:\"删除\",abort_removal_of_picked_videos:\"返回\",with_subtitle_badge:\"sub\",without_subtitle_badge:\"添加字幕\",prompt_already_uploaded_subtitle:\"您已上传过该视频的字幕\",replace_subtitle:\"更换\",remove_subtitle:\"移除\",keep_current_subtitle:\"返回\",search_box_placeholder:\"搜索\",btn_review_subtitle:\"更换或移除字幕\",btn_add_subtitle:\"添加字幕\",btn_delete_project:\"删除项目\",btn_edit_project:\"开始编辑\",deletion_confirmation:\"确定要删除吗？\",have_upload:\"已上传{{uploaded_num}}，剩余{{remain_num}}/{{max_num}}\"},project:{page_title:\"图文编辑-剪刀兔\",nav:{save_project:\"保存\",back_to_portal:\"返回列表\",preview_project:\"预览\",export_project:\"发布\"},prompt:{successfully_saved:\"保存成功\",failed_to_save:\"保存失败\",failed_to_export:\"发布失败\",exporting:\"正在发布中，请稍后...\"},left_panel:{save_project_and_leave:\"保存并离开\",discard_changes_and_leave:\"舍弃更改\",prompt_unsaved_changes:\"您的更改还未保存\",stay_on_page:\"继续编辑\",exporting_in_progress:\"发布中\",frontend_version:\"前端版本\",native_client_version:\"Native Client 版本\",project_size:\"当前图文总大小\",stop_previewing:\"关闭\"},right_panel:{hidden_content:\"已删除\",restore_hidden_content:\"恢复\",new_textual_content:\"新增文本\",project_size_label:\"当前图文总大小：\",btn_drag_handle:\"拖动\",btn_convert_to_gif:\"开启GIF\",btn_revert_back_to_frames:\"关闭GIF\",btn_add_text:\"添加文字段落\",btn_delete:\"删除\",btn_merge:\"合并至上个段落\"},view_type:{leading_text:\"选择版式：\",hidden:\"无\",small:\"小图\",normal:\"中图\",large:\"大图\"}}},processing:{preset:{custom:\"自定义\"},error:{file_not_found:\"找不到待处理的文件\",bad_parameters:\"参数错误\",cannot_decode_video:\"视频无法解码\"}},processing_status:{not_started:\"未处理\",started:\"已开始\",completed:\"已处理\",failed:\"处理失败\"},project:{project_not_found:\"找不到请求的视频图文编辑项目\"},project_export:{source_file_not_found:\"无法找到视频源文件\",media_files_missing:\"无法找到图片源文件\"},project_saving:{source_file_not_found:\"无法找到视频源文件\"}};","/* global _czc */\n\n\n// CSS\n\nimport '../css/app.pcss';\n\nimport '../vendors/trix.css';\n\n// Helpers \n\nconst readStringifiedJson = str => {\n  try {\n    return JSON.parse ( str );\n  }\n  catch ( error ) {\n    return;\n  }\n};\n\n// Translations\n\nimport translations from '../../translation/chi.json';\n\n// Elm\n\nimport { Elm } from '../../src/Main.elm';\n\nvar app = Elm.Main.init ({\n  flags: {\n    token: localStorage.token || null,\n    translations: translations,\n    hostname: location.hostname\n  }\n});\n\n\ndocument.addEventListener ( 'dragover', event => {\n  // prevent default to allow drop\n  event.preventDefault ();\n}, false );\n\ndocument.addEventListener ( 'drop', event => {\n  // prevent default action (open as link for some elements)\n  event.preventDefault ();\n}, false );\n\ndocument.addEventListener ( 'keydown', event => {\n  if ( event.key == 's' && event.ctrlKey ) {\n    event.preventDefault ();\n  }\n  else if ( event.key == 'e' && event.ctrlKey ) {\n    event.preventDefault ();\n  }\n  else if ( event.key == 'z' && event.ctrlKey ) {\n    event.preventDefault ();\n  }\n}, false );\n\n\napp.ports.seekTime.subscribe ( milliseconds => {\n  const video = document.querySelector ( 'video#source-file' );\n  video.currentTime = milliseconds / 1000;\n  video.play ();\n});\n\n\nconst connectSocket = () => {\n  var socket = new WebSocket ( 'ws://localhost:16699' );\n\n  socket.addEventListener ( 'close', event => {\n    app.ports.websocketClosed.send ( event.code );\n  });\n\n  socket.addEventListener ( 'message', event => {\n    let message = JSON.parse ( event.data );\n    handleSocketEvent ( message['Command'], message );\n  });\n};\n\nconnectSocket ();\n\n\napp.ports.connectSocket.subscribe (() => {\n  connectSocket ();\n});\n\nconst handleSocketEvent = ( event, data ) => {\n  switch ( event ) {\n    case 'ProcessProgressEvent':\n      handleProcessProgressEvent ( data );\n      break;\n\n    case 'ProcessFailureEvent':\n      handleProcessFailureEvent ( data );\n      break;\n\n    default:\n      break;\n  }\n};\n\n\nconst handleProcessProgressEvent = data => {\n  let uuid = data.Parameter.Id;\n\n  switch ( data.Parameter.Status ) {\n    case 1:\n      // When the video processing job is ready to start:\n      app.ports.processingStatusUpdate.send ({\n        Id: uuid,\n        Status: 1 // 'ready' \n      });\n      break;\n\n    case 2: {\n      // When the video processing job is ongoing:\n      let progress = data.Parameter.Progress;\n\n      app.ports.processingStatusUpdate.send ({\n        Id: uuid,\n        Status: 2, // 'ongoing'\n        Progress: progress\n      });\n\n      break;\n    }\n\n    case 3: {\n      // When the video processing job is completed:\n      app.ports.processingStatusUpdate.send ({\n        Id: uuid,\n        Status: 3 // 'completed'\n      });\n\n      break;\n    }\n\n    default:\n      // When God knows why an unknown status code is received:\n      break;\n  }\n};\n\n\nconst handleProcessFailureEvent = data => {\n  app.ports.processingStatusUpdate.send ({\n    uuid: data.Id,\n    status: 'failed',\n    reason: data.ErrorMsg\n  });\n};\n\n\napp.ports.undoTrix.subscribe (() => {\n  document.activeElement.editor.undo ();\n});\n\n\napp.ports.redoTrix.subscribe (() => {\n  document.activeElement.editor.redo ();\n});\n\n\napp.ports.scrollIntoView.subscribe ( nodeID => {\n  document.getElementById ( nodeID ).scrollIntoView ( true );\n});\n\n\nconst promptUserBeforeUnload = event => {\n  event.preventDefault ();\n  event.returnValue = '';\n  /*\n      Case: Uesr click go-back button -> Prompt(leave or cancel ?) -> Cancel\n    ----------------------------------------------------------------------------------------------\n      Probs: In this case, although the \"promptUserBeforeUnload\" prevent the redirection, the url was changed.\n    -----------------------------------------------------------------------------------------------------------\n      Solution: To avoid the troubles brought by the changed url, we have to: (1) get the url of current page (2) push the url to history\n  */\n  history.pushState(null, \"\", window.url); // (2) push the url to history\n};\n\napp.ports.addBeforeUnloadPrompt.subscribe (() => {\n  window.addEventListener ( 'beforeunload', promptUserBeforeUnload );\n  window.url = location.pathname; // (1) get the url of currentpage\n});\n\n\napp.ports.removeBeforeUnloadPrompt.subscribe (() => {\n  window.removeEventListener ( 'beforeunload', promptUserBeforeUnload );\n});\n\n\n\n// Web components\n\nclass RichTextPreview extends HTMLElement {\n  constructor () {\n    super ();\n  }\n\n  connectedCallback () {\n    this.setContent ();\n  }\n\n  attributeChangedCallback () { \n    this.setContent (); \n  }\n\n  static get observedAttributes () {\n    return [ 'content-value' ];\n  }\n\n  setContent () {\n    const content = this.getAttribute ( 'content-value' );\n    this.innerHTML = content;\n  }\n}\n\ncustomElements.define ( 'rich-text-preview', RichTextPreview );\n\n\n// Analytics \n\nlet previousHref = document.location.href;\n\nwindow.onload = () => {\n  let body = document.querySelector ( 'body' );\n\n  let observer = new MutationObserver ( mutations => {\n    mutations.forEach ( mutation => {\n      if ( document.location.href != previousHref ) {\n        previousHref = document.location.href;\n        _czc.push ([ '_trackPageview', location.pathname ]);\n      }\n    });\n  });\n\n  const config = {\n    childList: true,\n    subtree: true\n  };\n\n  observer.observe ( body, config );\n};\n\n\n\nexport default {\n  app: app\n};"]}